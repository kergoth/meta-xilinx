#@TYPE: Machine
#@NAME: zc702-zynq7-mel
#@DESCRIPTION: Mentor Embedded Linux Machine support for ZC702 Evaluation Board.
#
# For full details on the ZC702EK and associated tools, refer to the meta-xilinx
# layer.

require conf/machine/include/tune-zynq.inc
require conf/machine/include/machine-xilinx-default.inc
require conf/machine/include/machine-xilinx-board.inc

# ZC70x machine definition known by Xilinx UBOOT
UBOOT_MACHINE = "zynq_zc70x_config"

SERIAL_CONSOLE = "115200 ttyPS0"

MACHINE_DEVICETREE := " \
		zc702-mel/zc702-zynq7-mel.dts \
		${@bb.utils.contains("MACHINE_FEATURES", "hdmi", "zc702-mel/zc702-zynq7-base-trd-2015-2.dts", "", d)} \
		"

MACHINE_KCONFIG := "common/linux/rtc.cfg"

MACHINE_FEATURES = "vfat ext2 mel-master"

MACHINE_EXTRA_RRECOMMENDS += "udev-extraconf kernel-modules"

MACHINEOVERRIDES_append = ":zc702"

IMAGE_BOOT_FILES += "boot.bin uEnv.txt ${MACHINE}.dtb ${@bb.utils.contains("MACHINE_FEATURES", "hdmi", "zc702-zynq7-base-trd-2015-2.dtb", "", d)}"

# u-boot is needed for the IMAGE_BOOT_FILES
do_image_wic[depends] += "virtual/bootloader:do_deploy"

# WIC image type support
IMAGE_FSTYPES += "wic"
WKS_FILE ?= "sdimage-bootpart-4g.wks"

# dosfstools is needed to create the boot partition, mtools to copy to it
IMAGE_DEPENDS_wic_append = " dosfstools-native mtools-native parted-native"
